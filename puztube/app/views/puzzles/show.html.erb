<%= stylesheet_link_tag "rounded" %>

<%= javascript_include_tag :defaults, :juggernaut %>
<%= javascript_include_tag "juggernaut-users" %>
<%= juggernaut :channels => [@puzzle.chat_id], :client_id => current_user ? current_user.login : "anon", :debug => false %>

<script type="text/javascript" charset="utf-8">
  document.observe("dom:loaded", function() {
    <% @chatusers.each do |c| %>
    subscribe_user('<%=h c["client_id"] %>',true);
    <% end %>
    update_users();
    new Draggable('chatwindow',{});
  });
</script>

<%= render "welcome/login" %> 

<div id="info">
<%= render :partial => 'info' %>
</div>
<%= link_to_remote 'New Comment', :url => new_workspace_path(:type => 'puzzle', :id => @puzzle.id), :method => :post %>
<div id="comments">
<% @puzzle.workspaces.each do |ws| %>
  <%= render :partial => 'workspace/block', :locals => { :workspace => ws } %>
<% end %>
</div>

<%= render :partial => 'chats/window', :locals => { :chats => @chats, :cid => @puzzle.id } %>